<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Seed Extractor</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå±</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --bg:#0d1117;--card:#161b22;--border:#30363d;
            --green:#4ade80;--green-dim:rgba(74,222,128,.12);
            --green-glow:rgba(74,222,128,.25);--text:#e6edf3;
            --muted:#8b949e;--red:#f85149;--red-dim:rgba(248,81,73,.1);
            --orange:#f0883e;--blue:#58a6ff;--purple:#bc8cff;--yellow:#d29922;
        }
        @keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
        @keyframes pulse{0%,100%{box-shadow:0 0 0 0 var(--green-glow)}50%{box-shadow:0 0 0 10px transparent}}
        @keyframes spin{to{transform:rotate(360deg)}}
        @keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}
        @keyframes tagIn{from{opacity:0;transform:scale(.85)}to{opacity:1;transform:scale(1)}}

        body{
            font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
            background:var(--bg);color:var(--text);
            min-height:100vh;display:flex;flex-direction:column;
            align-items:center;justify-content:center;padding:20px;
            background-image:
                radial-gradient(circle at 20% 50%,rgba(74,222,128,.04) 0%,transparent 50%),
                radial-gradient(circle at 80% 50%,rgba(56,189,248,.04) 0%,transparent 50%);
        }
        .container{max-width:660px;width:100%;text-align:center}
        .logo{font-size:3.2em;margin-bottom:4px;display:block;filter:drop-shadow(0 0 20px var(--green-glow))}
        h1{font-size:2em;font-weight:800;margin-bottom:6px;
            background:linear-gradient(135deg,var(--green),#38bdf8);
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .subtitle{color:var(--muted);margin-bottom:36px;font-size:1.05em;line-height:1.5}
        .subtitle strong{color:var(--text)}

        /* Drop zone */
        .drop-zone{border:2.5px dashed var(--border);border-radius:18px;padding:54px 32px;cursor:pointer;position:relative;transition:all .3s ease;background:var(--card)}
        .drop-zone:hover,.drop-zone.dragover{border-color:var(--green);background:var(--green-dim);transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,0,0,.3),0 0 0 1px var(--green)}
        .drop-zone .dz-icon{font-size:3.2em;margin-bottom:12px;display:block;transition:transform .3s}
        .drop-zone:hover .dz-icon{transform:scale(1.12) rotate(-4deg)}
        .drop-zone p{color:var(--muted);font-size:1.05em;line-height:1.6}
        .drop-zone p strong{color:var(--text)}
        .drop-zone input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer}
        .drop-zone .formats{margin-top:14px;font-size:.82em;color:#555;display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
        .drop-zone .formats span{background:rgba(255,255,255,.05);padding:3px 10px;border-radius:6px;border:1px solid rgba(255,255,255,.06)}
        .file-info{margin-top:14px;color:var(--muted);font-size:.88em}

        /* Result card */
        .result-card{margin-top:28px;background:var(--card);border:2px solid var(--green);border-radius:18px;padding:32px 28px;animation:fadeUp .5s ease both;box-shadow:0 0 40px rgba(74,222,128,.08)}
        .result-card h2{color:var(--green);margin-bottom:8px;font-size:1.4em}
        .result-card .world-name{color:var(--muted);margin-bottom:20px;font-size:.95em}
        .result-card .world-name strong{color:var(--text)}
        .seed-box{display:flex;align-items:center;gap:10px;background:rgba(0,0,0,.35);border-radius:14px;padding:16px 20px;border:1px solid var(--border)}
        .seed-value{flex:1;font-family:'Courier New',monospace;font-size:1.65em;font-weight:700;color:#fff;letter-spacing:.5px;word-break:break-all;text-align:left;user-select:all}
        .copy-btn{background:var(--green);color:#0d1117;border:none;border-radius:10px;padding:10px 18px;font-size:.95em;cursor:pointer;font-weight:700;transition:all .2s;white-space:nowrap;display:flex;align-items:center;gap:6px}
        .copy-btn:hover{background:#22c55e;transform:scale(1.05)}
        .copy-btn:active{transform:scale(.97)}
        .copy-btn.copied{background:#16a34a;animation:pulse .6s}

        /* Tags */
        .meta{margin-top:18px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
        .tag{background:rgba(255,255,255,.06);padding:5px 13px;border-radius:8px;font-size:.82em;color:var(--muted);border:1px solid var(--border);animation:tagIn .4s ease both;display:inline-flex;align-items:center;gap:4px}
        .tag strong{color:var(--text)}
        .tag:nth-child(1){animation-delay:.05s}.tag:nth-child(2){animation-delay:.1s}.tag:nth-child(3){animation-delay:.15s}
        .tag:nth-child(4){animation-delay:.2s}.tag:nth-child(5){animation-delay:.25s}.tag:nth-child(6){animation-delay:.3s}.tag:nth-child(7){animation-delay:.35s}
        .tag-snapshot{border-color:rgba(240,136,62,.3);background:rgba(240,136,62,.1)}.tag-snapshot strong{color:var(--orange)}
        .tag-hardcore{border-color:rgba(248,81,73,.3);background:rgba(248,81,73,.1)}.tag-hardcore strong{color:var(--red)}
        .tag-cheats{border-color:rgba(210,153,34,.3);background:rgba(210,153,34,.1)}.tag-cheats strong{color:var(--yellow)}
        .tag-edition{border-color:rgba(88,166,255,.3);background:rgba(88,166,255,.08)}.tag-edition strong{color:var(--blue)}
        .tag-version{border-color:rgba(74,222,128,.3);background:rgba(74,222,128,.08)}.tag-version strong{color:var(--green)}

        .dv-info{display:block;margin-top:14px;font-size:.75em;color:#444;font-family:monospace}
        .another-btn{display:inline-flex;align-items:center;gap:6px;margin-top:20px;background:transparent;border:1px solid var(--border);color:var(--muted);border-radius:10px;padding:8px 18px;cursor:pointer;font-size:.88em;transition:all .2s}
        .another-btn:hover{border-color:var(--green);color:var(--green)}

        /* Help paths */
        .paths{margin-top:24px;text-align:left;background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden}
        .paths summary{cursor:pointer;padding:12px 18px;color:var(--muted);font-size:.88em;user-select:none;list-style:none;display:flex;align-items:center;gap:6px}
        .paths summary::-webkit-details-marker{display:none}
        .paths summary::before{content:'‚ñ∏';transition:transform .2s;display:inline-block;font-size:.8em}
        .paths[open] summary::before{transform:rotate(90deg)}
        .paths .pb{padding:4px 18px 16px;font-size:.82em;color:var(--muted);line-height:2}
        .paths h4{color:var(--text);margin:8px 0 4px;font-size:.9em}
        .paths ul{list-style:none;padding:0}
        .paths li{margin:3px 0;padding-left:8px}
        .paths li::before{content:'‚Ä¢';color:var(--green);margin-right:6px}
        .paths code{background:rgba(255,255,255,.06);padding:2px 7px;border-radius:4px;font-size:.9em;color:var(--text);word-break:break-all}
        .paths .note{margin-top:10px;font-size:.85em;color:#555;font-style:italic;border-top:1px solid var(--border);padding-top:10px}

        /* Error */
        .error-card{margin-top:28px;background:var(--red-dim);border:2px solid var(--red);border-radius:18px;padding:24px;color:var(--red);animation:fadeUp .4s ease,shake .5s .1s;font-size:1em;line-height:1.6}
        .error-card .another-btn{border-color:rgba(248,81,73,.3);color:var(--red)}.error-card .another-btn:hover{border-color:var(--red);color:#fff}

        /* Loading */
        .loading{margin-top:28px;display:flex;flex-direction:column;align-items:center;gap:14px}
        .spinner{width:38px;height:38px;border:3px solid var(--border);border-top-color:var(--green);border-radius:50%;animation:spin .7s linear infinite}
        .loading p{color:var(--muted);font-size:.95em}

        footer{margin-top:48px;color:#333;font-size:.78em;text-align:center;line-height:1.6}

        @media(max-width:520px){
            h1{font-size:1.5em}.seed-value{font-size:1.15em}
            .seed-box{flex-direction:column}.copy-btn{width:100%;justify-content:center}
            .drop-zone{padding:40px 20px}.meta{gap:6px}.tag{font-size:.78em;padding:4px 10px}
        }
    </style>
</head>
<body>
<div class="container">
    <span class="logo">‚õèÔ∏è</span>
    <h1>Minecraft Seed Extractor</h1>
    <p class="subtitle">Sube tu archivo <strong>level.dat</strong> para extraer la semilla del mundo.<br>Compatible con <strong>Java</strong> y <strong>Bedrock</strong>, todas las versiones.</p>

    <div class="drop-zone" id="dropZone">
        <span class="dz-icon">üìÇ</span>
        <p>Arrastra y suelta <strong>level.dat</strong> aqu√≠<br>o haz clic para seleccionar</p>
        <div class="formats"><span>Java Edition</span><span>Bedrock Edition</span><span>Todas las versiones</span></div>
        <input type="file" id="fileInput" accept=".dat,.dat_old">
    </div>
    <div id="fileInfo" class="file-info"></div>

    <!-- Output: resultado o error -->
    <div id="output"></div>

    <!-- Ayuda de rutas: DEBAJO del resultado -->
    <details class="paths" id="pathsHelp">
        <summary>üìÅ ¬øD√≥nde encuentro level.dat?</summary>
        <div class="pb">
            <h4>‚òï Java Edition</h4>
            <ul>
                <li><strong>Windows:</strong> <code>%APPDATA%\.minecraft\saves\&lt;mundo&gt;\level.dat</code></li>
                <li><strong>macOS:</strong> <code>~/Library/Application Support/minecraft/saves/&lt;mundo&gt;/level.dat</code></li>
                <li><strong>Linux:</strong> <code>~/.minecraft/saves/&lt;mundo&gt;/level.dat</code></li>
            </ul>
            <h4>ü™® Bedrock Edition</h4>
            <ul>
                <li><strong>Windows:</strong> Abre <em>Ejecutar</em> (Win+R) ‚Üí escribe <code>%LOCALAPPDATA%\Packages\</code> ‚Üí busca la carpeta que empiece por <code>Microsoft.Minecraft</code> ‚Üí entra en <code>LocalState\games\com.mojang\minecraftWorlds\&lt;mundo&gt;\</code></li>
                <li><strong>Android:</strong> <code>/storage/emulated/0/Android/data/com.mojang.minecraftpe/files/games/com.mojang/minecraftWorlds/&lt;mundo&gt;/</code>
                    <br><small>(Requiere un gestor de archivos con acceso a <code>Android/data</code>)</small></li>
                <li><strong>iOS / iPadOS:</strong> App <em>Archivos</em> ‚Üí En mi iPhone ‚Üí Minecraft ‚Üí games ‚Üí com.mojang ‚Üí minecraftWorlds ‚Üí &lt;mundo&gt;</li>
                <li><strong>Consolas:</strong> No es posible acceder al archivo directamente. Puedes transferir el mundo a Windows/m√≥vil usando Realms o herramientas externas.</li>
            </ul>
            <p class="note">üí° Las rutas exactas pueden variar seg√∫n la versi√≥n del juego y del sistema operativo. Si la carpeta del paquete se llama <code>Microsoft.MinecraftUWP_...</code>, <code>Microsoft.MinecraftWindowsBeta_...</code> o similar, el resto de la ruta es igual.</p>
        </div>
    </details>
</div>

<footer>Funciona 100 % en tu navegador ‚Äî ning√∫n archivo se sube a ning√∫n servidor.</footer>

<script>
/* ================================================================
   NBT Reader ‚Äî Big-Endian (Java) & Little-Endian (Bedrock)
   ================================================================ */
class NBTReader{
    constructor(d,le=false){
        let buf;
        if(d instanceof Uint8Array) buf=d.buffer.slice(d.byteOffset,d.byteOffset+d.byteLength);
        else if(d instanceof ArrayBuffer) buf=d;
        else buf=d;
        this.v=new DataView(buf);this.o=0;this.le=le;
    }
    _c(n){if(this.o+n>this.v.byteLength)throw new RangeError('NBT truncado')}
    u8(){this._c(1);return this.v.getUint8(this.o++)}
    i8(){this._c(1);return this.v.getInt8(this.o++)}
    i16(){this._c(2);const r=this.v.getInt16(this.o,this.le);this.o+=2;return r}
    u16(){this._c(2);const r=this.v.getUint16(this.o,this.le);this.o+=2;return r}
    i32(){this._c(4);const r=this.v.getInt32(this.o,this.le);this.o+=4;return r}
    f32(){this._c(4);const r=this.v.getFloat32(this.o,this.le);this.o+=4;return r}
    f64(){this._c(8);const r=this.v.getFloat64(this.o,this.le);this.o+=8;return r}
    i64(){this._c(8);const r=this.v.getBigInt64(this.o,this.le);this.o+=8;return r}
    str(){const n=this.u16();this._c(n);const b=new Uint8Array(this.v.buffer,this.o,n);this.o+=n;return new TextDecoder('utf-8').decode(b)}
    tag(t){
        switch(t){
            case 0:return null;case 1:return this.i8();case 2:return this.i16();
            case 3:return this.i32();case 4:return this.i64();case 5:return this.f32();
            case 6:return this.f64();case 8:return this.str();
            case 7:{const n=this.i32(),a=new Int8Array(n);for(let i=0;i<n;i++)a[i]=this.i8();return a}
            case 9:{const et=this.u8(),n=this.i32(),a=[];for(let i=0;i<n;i++)a.push(this.tag(et));return a}
            case 10:{const o={};for(;;){const t=this.u8();if(!t)break;const k=this.str();o[k]=this.tag(t)}return o}
            case 11:{const n=this.i32(),a=new Int32Array(n);for(let i=0;i<n;i++)a[i]=this.i32();return a}
            case 12:{const n=this.i32(),a=[];for(let i=0;i<n;i++)a.push(this.i64());return a}
            default:throw new Error('Tag NBT desconocido: '+t);
        }
    }
    parse(){const t=this.u8();if(t!==10)throw new Error('Root no es Compound');this.str();return this.tag(10)}
}

/* ================================================================
   VERSION DETECTION ‚Äî Java & Bedrock
   ================================================================ */

/* ---------- helpers ---------- */
function N(v){return typeof v==='bigint'?Number(v):typeof v==='number'?v:null}
function has(o,k){return o!==undefined&&o!==null&&o[k]!==undefined}
const GM=['Supervivencia','Creativo','Aventura','Espectador'];
const DF=['Pac√≠fico','F√°cil','Normal','Dif√≠cil'];

/* ---------- DataVersion ‚Üí release name ---------- */
const DV_RELEASES=[
    [169,'1.9'],[175,'1.9.1'],[176,'1.9.2'],[183,'1.9.3'],[184,'1.9.4'],
    [510,'1.10'],[511,'1.10.1'],[512,'1.10.2'],
    [819,'1.11'],[921,'1.11.1'],[922,'1.11.2'],
    [1139,'1.12'],[1241,'1.12.1'],[1343,'1.12.2'],
    [1519,'1.13'],[1628,'1.13.1'],[1631,'1.13.2'],
    [1952,'1.14'],[1957,'1.14.1'],[1963,'1.14.2'],[1968,'1.14.3'],[1976,'1.14.4'],
    [2225,'1.15'],[2227,'1.15.1'],[2230,'1.15.2'],
    [2566,'1.16'],[2567,'1.16.1'],[2578,'1.16.2'],[2580,'1.16.3'],[2584,'1.16.4'],[2586,'1.16.5'],
    [2724,'1.17'],[2730,'1.17.1'],
    [2860,'1.18'],[2865,'1.18.1'],[2975,'1.18.2'],
    [3105,'1.19'],[3117,'1.19.1'],[3120,'1.19.2'],[3218,'1.19.3'],[3337,'1.19.4'],
    [3463,'1.20'],[3465,'1.20.1'],[3578,'1.20.2'],[3698,'1.20.3'],[3700,'1.20.4'],
    [3837,'1.20.5'],[3839,'1.20.6'],
    [3953,'1.21'],[3955,'1.21.1'],[4080,'1.21.2'],[4082,'1.21.3'],[4189,'1.21.4'],
    [4325,'1.21.5'],
];
const DV_MAP=Object.fromEntries(DV_RELEASES);

function dvToName(dv){
    if(DV_MAP[dv])return DV_MAP[dv];
    let lo=null,hi=null;
    for(const[v,n]of DV_RELEASES){if(v<dv)lo=n;if(v>dv&&!hi)hi=n}
    if(lo&&hi)return`Snapshot entre ${lo} y ${hi}`;
    if(lo)return`Post-${lo} (Snapshot)`;
    if(hi)return`Pre-${hi} (Snapshot)`;
    return null;
}

/* ---------- Pre-1.9 Java heuristics ---------- */
function detectOldJava(d){
    const ver=N(d.version);

    /* ---- Sin campo version: Infdev / Alpha ---- */
    if(ver===null) return 'Infdev / Alpha';

    /* ---- MCRegion (Beta 1.3 ‚Üí 1.1) ---- */
    if(ver===19132){
        // hardcore byte added in Beta 1.9 Pre-release 2
        if(has(d,'hardcore')){
            // generatorName added in snapshot 12w01a (for 1.2), not present in releases ‚â§1.1
            // But some 1.0/1.1 worlds might have been opened in snapshots.
            // Best we can do:
            return 'Beta 1.9-pre2 ‚Äì 1.1';
        }
        // GameType added in Beta 1.8
        if(has(d,'GameType'))return 'Beta 1.8 ‚Äì Beta 1.9-pre1';
        // MapFeatures existed since MCRegion but GameType didn't
        if(has(d,'Player'))return 'Beta 1.3 ‚Äì Beta 1.7.3';
        return 'Beta 1.3 ‚Äì Beta 1.7.3';
    }

    /* ---- Anvil (1.2+) ---- */
    if(ver===19133){
        const r=d.GameRules||{};

        // --- 1.8 indicators ---
        if(has(d,'DifficultyLocked')
            ||has(d,'BorderSize')||has(d,'BorderCenterX')||has(d,'BorderCenterZ')
            ||has(d,'BorderWarningBlocks')||has(d,'BorderWarningTime')
            ||has(d,'BorderDamagePerBlock')||has(d,'BorderSafeZone')
            ||has(r,'logAdminCommands')||has(r,'sendCommandFeedback')
            ||has(r,'reducedDebugInfo')||has(r,'randomTickSpeed')
            ||d.generatorName==='customized'||d.generatorName==='debug_all_block_states'){
            return '1.8 ‚Äì 1.8.9';
        }

        // --- 1.7 indicators ---
        if(d.generatorName==='amplified')return '1.7 ‚Äì 1.7.10';

        // --- 1.4+ indicators ---
        if(has(d,'initialized')
            ||has(r,'doDaylightCycle')||has(r,'naturalRegeneration')
            ||has(r,'doMobLoot')||has(r,'doMobSpawning')||has(r,'doTileDrops')
            ||has(r,'showDeathMessages')){

            // Try to distinguish 1.6‚Äì1.7 from 1.4‚Äì1.5
            // 1.7 added largeBiomes as generator option (already existed as biome setting)
            // Difficult to narrow further without DataVersion
            // Check for 1.6 resource-pack fields (not reliable)
            // Check generator name for clues
            if(d.generatorName==='largeBiomes')return '1.4 ‚Äì 1.7.10';
            return '1.4 ‚Äì 1.7.10';
        }

        // --- 1.3 indicators ---
        if(has(d,'allowCommands')||Object.keys(r).length>0)return '1.3 ‚Äì 1.3.2';

        return '1.2 ‚Äì 1.2.5';
    }

    return `Formato desconocido (v${ver})`;
}

/* ---------- Java generator type ---------- */
function detectJavaGen(d){
    if(typeof d.generatorName==='string'){
        const m={'default':'Normal','flat':'Superplano','largeBiomes':'Biomas grandes',
            'amplified':'Amplificado','customized':'Personalizado',
            'debug_all_block_states':'Debug','buffet':'Buffet'};
        return m[d.generatorName]||d.generatorName;
    }
    const wgs=d.WorldGenSettings;
    if(wgs&&wgs.dimensions){
        const ow=wgs.dimensions['minecraft:overworld'];
        const g=ow?.generator;
        if(g){
            if(g.type==='minecraft:flat')return 'Superplano';
            if(g.type==='minecraft:debug')return 'Debug';
            if(typeof g.settings==='string'){
                if(g.settings.includes('large_biomes'))return 'Biomas grandes';
                if(g.settings.includes('amplified'))return 'Amplificado';
                if(g.settings.includes('single_biome'))return 'Bioma √∫nico';
            }
            return 'Normal';
        }
    }
    return null;
}

/* ---------- Bedrock StorageVersion ‚Üí version range ---------- */
function storageRange(sv){
    const m={1:'0.1.x',2:'0.2.x',3:'0.2.1 ‚Äì 0.8.1',4:'0.9.0 ‚Äì 0.12.3',
        5:'0.13.0 ‚Äì 0.15.10',6:'0.16.0 ‚Äì 0.16.221',7:'1.0.0 ‚Äì 1.1.7',
        8:'1.2.0 ‚Äì 1.17.41',9:'1.18.0 ‚Äì 1.18.12',10:'1.18.30+'};
    return m[sv]||null;
}

/* ---------- Main version detection ---------- */
function detectVersion(data){
    const info={edition:null,version:null,isSnapshot:false,dataVersion:null,
        gameMode:null,hardcore:false,generator:null,difficulty:null,cheats:null};

    /* ==================== JAVA EDITION ==================== */
    if(data.Data!==undefined){
        const d=data.Data;
        info.edition='Java Edition';

        /* 1) Version compound (Java 1.9+) ‚Äî exact version name */
        if(d.Version&&typeof d.Version==='object'&&typeof d.Version.Name==='string'){
            info.version=d.Version.Name;
            const s=d.Version.Snapshot;
            info.isSnapshot=(s===1||s===1n||s===true);
            info.dataVersion=N(d.Version.Id)??N(d.DataVersion);
        }
        /* 2) DataVersion without Version compound (rare edge case) */
        else if(d.DataVersion!==undefined){
            info.dataVersion=N(d.DataVersion);
            const name=dvToName(info.dataVersion);
            info.version=name||`DataVersion ${info.dataVersion}`;
            info.isSnapshot=!DV_MAP[info.dataVersion];
        }
        /* 3) Pre-1.9: heuristics */
        else{
            info.version=detectOldJava(d);
        }

        info.gameMode=GM[N(d.GameType)]||null;
        info.hardcore=(N(d.hardcore)===1);
        info.difficulty=DF[N(d.Difficulty)]||null;
        if(has(d,'allowCommands'))info.cheats=(N(d.allowCommands)===1);
        info.generator=detectJavaGen(d);
        return info;
    }

    /* ==================== BEDROCK EDITION ==================== */
    if(has(data,'StorageVersion')||has(data,'lastOpenedWithVersion')
        ||has(data,'NetworkVersion')||has(data,'FormatVersion')
        ||has(data,'InventoryVersion')){

        info.edition='Bedrock Edition';

        /* Exact version from lastOpenedWithVersion [major,minor,patch,rev,beta] */
        const lov=data.lastOpenedWithVersion;
        if(lov&&Array.isArray(lov)&&lov.length>=3){
            const p=lov.map(v=>Number(typeof v==='bigint'?v:v));
            const beta=p.length>=5&&p[4]===1;
            info.version=`${p[0]}.${p[1]}.${p[2]}${beta?' (Beta)':''}`;
        }
        else if(typeof data.InventoryVersion==='string'){
            info.version=data.InventoryVersion;
        }
        else{
            const sv=N(data.StorageVersion);
            const range=sv!==null?storageRange(sv):null;
            info.version=range||( sv!==null?`Storage v${sv}`:'Desconocida');
        }

        info.gameMode=GM[N(data.GameType)]||null;
        info.difficulty=DF[N(data.Difficulty)]||null;

        if(typeof data.Generator==='number')
            info.generator=['Antiguo (finito)','Normal','Superplano'][data.Generator]||null;

        const chk=has(data,'commandsEnabled')?N(data.commandsEnabled):
                   has(data,'cheatsEnabled')?N(data.cheatsEnabled):null;
        if(chk!==null)info.cheats=(chk===1);

        return info;
    }

    /* ==================== VERY OLD JAVA (Infdev/Alpha ‚Äî no Data compound) ==================== */
    if(has(data,'RandomSeed')||has(data,'SpawnX')||has(data,'Time')){
        info.edition='Java Edition';
        info.version='Infdev / Alpha (pre-Beta 1.3)';
        return info;
    }

    info.edition='Desconocida';info.version='No identificada';return info;
}

/* ================================================================
   SEED FINDING
   ================================================================ */
function findSeed(data){
    let s;
    s=data?.Data?.WorldGenSettings?.seed; if(typeof s==='bigint')return s; if(typeof s==='number')return BigInt(s);
    s=data?.Data?.RandomSeed;             if(typeof s==='bigint')return s; if(typeof s==='number')return BigInt(s);
    s=data?.RandomSeed;                   if(typeof s==='bigint')return s; if(typeof s==='number')return BigInt(s);
    return deep(data,0);
}
function deep(o,d){
    if(d>14||!o||typeof o!=='object')return null;
    for(const k of Object.keys(o)){
        if((k==='RandomSeed'||k==='seed')&&(typeof o[k]==='bigint'||typeof o[k]==='number'))
            return typeof o[k]==='bigint'?o[k]:BigInt(o[k]);
        if(typeof o[k]==='object'&&o[k]!==null&&!(o[k] instanceof Int8Array)&&!(o[k] instanceof Int32Array)){
            const r=deep(o[k],d+1);if(r!==null)return r;
        }
    }return null;
}
function findName(data){
    if(typeof data?.Data?.LevelName==='string')return data.Data.LevelName;
    if(typeof data?.LevelName==='string')return data.LevelName;
    return null;
}

/* ================================================================
   PROCESS FILE
   ================================================================ */
async function processFile(file){
    const out=document.getElementById('output');
    const inf=document.getElementById('fileInfo');
    inf.textContent=`üìÑ ${file.name}  (${(file.size/1024).toFixed(1)} KB)`;
    out.innerHTML='<div class="loading"><div class="spinner"></div><p>Analizando archivo‚Ä¶</p></div>';
    await new Promise(r=>setTimeout(r,50));

    try{
        const buf=await file.arrayBuffer();
        const u8=new Uint8Array(buf);
        const gz=u8.length>=2&&u8[0]===0x1F&&u8[1]===0x8B;
        const attempts=[];

        if(gz)attempts.push(()=>new NBTReader(pako.inflate(u8),false).parse());
        if(buf.byteLength>8)attempts.push(()=>new NBTReader(buf.slice(8),true).parse());
        attempts.push(()=>new NBTReader(buf,false).parse());
        attempts.push(()=>new NBTReader(buf,true).parse());
        if(!gz)attempts.push(()=>new NBTReader(pako.inflate(u8),false).parse());
        if(buf.byteLength>4)attempts.push(()=>new NBTReader(buf.slice(4),true).parse());

        for(const fn of attempts){
            try{
                const nbt=fn();
                const seed=findSeed(nbt);
                if(seed!==null){showResult(nbt,seed);return}
            }catch(_){}
        }
        showError('No se pudo encontrar la semilla.<br>Aseg√∫rate de subir un archivo <strong>level.dat</strong> v√°lido de Minecraft (Java o Bedrock).');
    }catch(e){showError('Error al procesar: '+esc(e.message))}
}

/* ================================================================
   UI
   ================================================================ */
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}

function showResult(nbt,seed){
    const name=findName(nbt);
    const v=detectVersion(nbt);
    const out=document.getElementById('output');

    let nameH='';
    if(name)nameH=`<p class="world-name">üåç Mundo: <strong>${esc(name)}</strong></p>`;

    const tags=[];
    const ei=v.edition==='Java Edition'?'‚òï':'ü™®';
    tags.push(`<span class="tag tag-edition">${ei} <strong>${esc(v.edition)}</strong></span>`);

    let vc='tag tag-version',vl=esc(v.version);
    if(v.isSnapshot){vc='tag tag-snapshot';vl+=' üì∏'}
    tags.push(`<span class="${vc}">üì¶ <strong>${vl}</strong></span>`);

    if(v.hardcore)tags.push(`<span class="tag tag-hardcore">üíÄ <strong>Hardcore</strong></span>`);
    if(v.gameMode)tags.push(`<span class="tag">üéÆ <strong>${esc(v.gameMode)}</strong></span>`);
    if(v.difficulty)tags.push(`<span class="tag">‚öîÔ∏è <strong>${esc(v.difficulty)}</strong></span>`);
    if(v.generator&&v.generator!=='Normal')tags.push(`<span class="tag">üó∫Ô∏è <strong>${esc(v.generator)}</strong></span>`);
    if(v.cheats===true)tags.push(`<span class="tag tag-cheats">‚ö° <strong>Trucos</strong></span>`);

    let dvH='';
    if(v.dataVersion)dvH=`<span class="dv-info">DataVersion: ${v.dataVersion}</span>`;

    out.innerHTML=`
    <div class="result-card">
        <h2>üå± ¬°Semilla encontrada!</h2>
        ${nameH}
        <div class="seed-box">
            <span class="seed-value" id="seedText">${esc(seed.toString())}</span>
            <button class="copy-btn" id="copyBtn" onclick="copySeed()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                     stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2"/>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                </svg> Copiar
            </button>
        </div>
        <div class="meta">${tags.join('')}</div>
        ${dvH}
        <button class="another-btn" onclick="resetUI()">üîÑ Subir otro archivo</button>
    </div>`;
}

function showError(msg){
    document.getElementById('output').innerHTML=`
    <div class="error-card">‚ùå ${msg}
        <br><button class="another-btn" onclick="resetUI()">üîÑ Intentar de nuevo</button>
    </div>`;
}

function resetUI(){
    document.getElementById('output').innerHTML='';
    document.getElementById('fileInfo').textContent='';
    document.getElementById('fileInput').value='';
}

async function copySeed(){
    const text=document.getElementById('seedText').textContent;
    const btn=document.getElementById('copyBtn');
    try{await navigator.clipboard.writeText(text)}
    catch(_){const t=document.createElement('textarea');t.value=text;t.style.cssText='position:fixed;left:-9999px';
        document.body.appendChild(t);t.select();document.execCommand('copy');document.body.removeChild(t)}
    btn.innerHTML=`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> ¬°Copiado!`;
    btn.classList.add('copied');
    setTimeout(()=>{
        btn.innerHTML=`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2"/>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg> Copiar`;
        btn.classList.remove('copied');
    },2200);
}

/* ================================================================
   Events
   ================================================================ */
const dz=document.getElementById('dropZone'),fi=document.getElementById('fileInput');
dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('dragover')});
dz.addEventListener('dragleave',()=>dz.classList.remove('dragover'));
dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('dragover');if(e.dataTransfer.files.length)processFile(e.dataTransfer.files[0])});
fi.addEventListener('change',e=>{if(e.target.files.length)processFile(e.target.files[0])});
</script>
</body>
</html>